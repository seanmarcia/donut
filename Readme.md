Port of donut.c by a1k0n.
